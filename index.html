<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shilahit Detox: tratamiento natural desintoxicante.</title>
  <meta name="description" content="Shilahit Detox: tratamiento natural desintoxicante. Resultados desde el primer mes. Compra con envío rápido y pago a contra entrega." />
  <meta name="keywords" content="Shilahit Detox: tratamiento natural desintoxicante. Resultados desde el primer mes. Compra con envío rápido y pago a contra entrega." />

  <!-- Preload imagen hero (prioritaria para LCP) -->
  <link rel="preload" as="image" href="imageneswebp/imagen1.webp" fetchpriority="high">

  <!-- Fuentes (no bloqueantes) -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" as="style" onload="this.rel='stylesheet'">
  <noscript>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
  </noscript>

  <style>
    :root{
      --red:#0c8b08; --red-dark:#b91c1c; --gold:#ffb300; --black:#0b0b0b;
      --surface:#111; --card:#151515; --muted:#b8c0cc;
      --ok:#10b981; --warn:#f59e0b; --ring:#ffffff22;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b0b0b,#121212 60%,#0b0b0b);color:#eaeaea;font-family:Poppins,system-ui,Segoe UI,Roboto,Arial,sans-serif;padding:12px;overflow-x:hidden}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block;margin:16px 2px;border-radius:16px;border:1px solid rgba(255,255,255,0.06);box-shadow:1px 1px 8px rgba(0,0,0,0.4)}

    /* Global effects */
    .btn{display:inline-flex;gap:.6rem;align-items:center;justify-content:center;padding:14px 22px;border-radius:999px;background:var(--red);font-weight:700;letter-spacing:.2px;width:100%;color:white;transition:.2s;margin:16px 2px;animation:heartbeat 1.5s ease-in-out infinite both}
    .btn:hover{background:var(--red-dark);transform:translateY(-1px)}
    .btn.outline{background:transparent;border:1px solid #ffffff33;animation:none}
    .contenedorbtn{display:flex;justify-content:center;margin-top:-20px;margin-bottom:-20px}

    /* Buttons small on modal footer */
    .modal .footer .btn{width:auto;padding:10px 16px;border-radius:10px}

    /* Hero */
    header.hero{position:relative;overflow:hidden;max-width:1200px;margin:0 auto}
    header.hero img{width:100%;height:auto;display:block;object-fit:cover;content-visibility:auto;contain-intrinsic-size:600px;border-radius:12px}

    /* Layout */
    main{max-width:1100px;margin:18px auto;padding:0 12px}
    .muted{color:#a8b0b8;font-weight:400;font-size:.95rem}

    /* Formulario y secciones */
    #orderForm{padding:18px;display:grid;gap:14px;background:transparent}
    #orderForm div{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .in{width:100%;margin-top:6px;padding:12px 14px;border:1px solid #ffffff10;background:#0f0f0f;border-radius:12px;color:#eaeaea;outline:none}
    .in:focus{border-color:var(--gold);box-shadow:0 0 0 4px var(--ring)}
    label{display:block;font-weight:600}
    .error{border-color:#ef4444!important}

    .preform{width:100%;background-image:url(gifsex.gif);min-height:350px;background-size:cover;border-radius:16px;background-attachment:fixed;max-width:1100px;background-position:center;display:flex;flex-wrap:wrap;justify-content:center;align-items:flex-end}

    /* Modal básico - inline crítico para evitar problemas MIME con archivo externo */
    .modal-overlay{display:none;position:fixed;inset:0;background:#000a;backdrop-filter:blur(4px);align-items:center;justify-content:center;z-index:10000;padding:16px}
    .modal-overlay.active{display:flex}
    .modal{width:min(960px,100%);max-height:92vh;overflow:auto;background:#0e0e0e;border:1px solid rgba(255,255,255,0.08);border-radius:16px;box-shadow:0 30px 80px #000c}
    .modal header{position:sticky;top:0;background:#0e0e0ef2;padding:16px 18px;border-bottom:1px solid rgba(255,255,255,0.06);display:flex;justify-content:space-between;align-items:center}
    .modal h3{margin:0;font-size:1.4rem}
    .modal .close{background:transparent;border:0;color:#fff;font-size:1.6rem;cursor:pointer;line-height:1}
    .modal .body{padding:18px}
    .modal .footer{padding:16px;border-top:1px solid rgba(255,255,255,0.06);display:flex;gap:12px;flex-wrap:wrap;justify-content:flex-end}

    .offers{display:grid;grid-template-columns:1fr;gap:12px;margin:12px 0 8px}
    .offer-card{display:grid;grid-template-columns:92px 1fr auto;gap:12px;align-items:center;padding:12px;border:1px solid rgba(255,255,255,0.05);border-radius:14px;background:#101010;cursor:pointer;transition:.18s}
    .offer-card:hover{border-color:rgba(255,255,255,0.14);transform:translateY(-2px)}
    .offer-card.active{outline:2px solid var(--red);box-shadow:0 0 0 4px rgba(255,255,255,0.06) inset}
    .offer-img{width:92px;height:92px;display:flex;align-items:center;justify-content:center;background:#0b0b0b;border-radius:10px;border:1px solid rgba(255,255,255,0.04);overflow:hidden}
    .offer-title{font-weight:700}
    .offer-badge{display:inline-flex;align-items:center;gap:6px;font-size:.75rem;padding:4px 8px;border-radius:999px;border:1px solid rgba(255,255,255,0.06);margin-left:6px}
    .badge-hot{background:#1e3a8a;color:#fff;border-color:transparent}
    .badge-save{background:#0f5132;color:#c6f6d5;border-color:transparent}
    .price{display:flex;flex-direction:column;align-items:flex-end}
    .price .compare{color:#94a3b8;text-decoration:line-through;font-size:.9rem}
    .price .current{font-size:1rem;font-weight:800}
    .totals{display:grid;gap:6px;padding:12px;border:1px dashed rgba(255,255,255,0.06);border-radius:12px;background:#0b0b0b;margin:8px 0 14px}
    .row{display:flex;justify-content:space-between;gap:12px}
    .row strong{font-weight:800}

    @media (max-width:980px){
      header{background-size:380px;background-repeat:no-repeat;background-position:95px 40px}
      #orderForm div{display:grid;grid-template-columns:1fr;gap:12px}
      .preform{background-position:-330px;background-attachment:scroll}
      .offer-card{grid-template-columns:53px 1fr auto}
      .offer-img{width:50px;height:50px}
    }

    @keyframes heartbeat {
      from {transform: scale(1)}
      10% {transform: scale(0.91)}
      17% {transform: scale(0.98)}
      33% {transform: scale(0.87)}
      45% {transform: scale(1)}
    }

    /* Toast visual */
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-10px);
      background: linear-gradient(90deg,#10b981,#059669);
      color: white;
      padding: 12px 18px;
      border-radius: 10px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.6);
      opacity: 0;
      pointer-events: none;
      transition: opacity .25s ease, transform .25s ease;
      z-index: 11000;
      font-weight:700;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events:auto; }
  </style>
</head>
<body>

  <header class="hero">
    <img src="imageneswebp/imagen1.webp" alt="Shilahit Detox" fetchpriority="high" decoding="async" width="1200" height="675">
  </header>

  <main>
    <img src="imageneswebp/imagen2.webp" alt="Producto Shilahit">
    <div class="contenedorbtn">
      <a href="#checkout" class="btn">Ordenar ahora</a>
    </div>

    <img src="imageneswebp/imagen3.webp" alt="Beneficios Shilahit">

    <img loading="lazy" decoding="async" src="imageneswebp/imagen4.webp" alt="">
    <img loading="lazy" decoding="async" src="imageneswebp/imagen5.webp" alt="">
    <img loading="lazy" decoding="async" src="imageneswebp/imagen6.webp" alt="">

    <div class="contenedorbtn">
      <a href="#oferta" class="btn">Comenzar ahora</a>
    </div>

    <img loading="lazy" decoding="async" src="imageneswebp/imagen7.webp" alt="">
    <img loading="lazy" decoding="async" src="imageneswebp/imagen8.webp" alt="">
    <img loading="lazy" decoding="async" src="imageneswebp/imagen9.webp" alt="">

    <div class="contenedorbtn">
      <a href="#checkout" class="btn">Ordenar ahora</a>
    </div>
  </main>

  <!-- ===== MODAL DE OFERTAS ===== -->
  <div class="modal-overlay" id="checkoutModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="modal" role="document">
      <header>
        <div>
          <h3 id="modalTitle">Elije tu Oferta</h3>
          <div class="muted" id="modalSubtitle">Recuerda que pagas al recibir</div>
        </div>
        <button class="close" id="closeCheckout" aria-label="Cerrar">×</button>
      </header>

      <div class="body">
        <!-- Selector de ofertas -->
        <div class="offers" id="offerList">
          <div class="offer-card" data-offer="Compra 1" data-qty="1" data-price="150000" data-compare="150000" tabindex="0">
            <div class="offer-img"><img decoding="async" loading="lazy" src="imageneswebp/Soloshilajit.webp" alt="Shilahit 1 frasco"></div>
            <div>
              <div class="offer-title">Compra 1</div>
              <div class="muted">1 Shilahit Detox (180 tabletas)</div>
              <span class="offer-badge badge-hot"></span>
            </div>
            <div class="price">
              <span class="current">$150.000</span>
            </div>
          </div>

          <div class="offer-card" data-offer="Compra 1 + Virilex -50%" data-qty="2" data-price="225000" data-compare="300000" tabindex="0">
            <div class="offer-img"><img decoding="async" loading="lazy" src="imageneswebp/Soloshilajit.webp" alt="Shilahit x2"></div>
            <div>
              <div class="offer-title">Compra 2</div>
              <div class="muted">1 Shilahit Detox segundo con 50% de descuento</div>
              <span class="offer-badge badge-hot">Más vendido</span>
            </div>
            <div class="price">
              <span class="compare">$300.000</span>
              <span class="current">$225.000</span>
            </div>
          </div>

          <div class="offer-card" data-offer="Compra 2 + 1 GRATIS" data-qty="3" data-price="300000" data-compare="450000" tabindex="0">
            <div class="offer-img"><img decoding="async" loading="lazy" src="imageneswebp/Soloshilajit.webp" alt="Shilahit 2+1"></div>
            <div>
              <div class="offer-title">Compra 2 + 1 GRATIS</div>
              <div class="muted">Tratamiento extendido (9 meses)</div>
              <span class="offer-badge badge-save">Más ahorro</span>
            </div>
            <div class="price">
              <span class="compare">$450.000</span>
              <span class="current">$300.000</span>
            </div>
          </div>
        </div>

        <!-- Totales -->
        <div class="totals" id="totalsBox" aria-live="polite">
          <div class="row"><span>Total</span><strong id="totalPrice">$0</strong></div>
          <div class="row"><span>Envío</span><strong class="accent">Gratis</strong></div>
        </div>

        <!-- Formulario dentro del modal -->
        <form id="orderForm" class="glass" novalidate>
          <!-- Honeypot -->
          <input type="text" name="website" id="hp" style="position:absolute;left:-9999px;top:-9999px" tabindex="-1" autocomplete="off" aria-hidden="true">

          <div>
            <label>Nombre y Apellidos
              <input required name="name" type="text" placeholder="Tu nombre completo" class="in" maxlength="80">
            </label>
            <label>WhatsApp
              <input required name="phone" type="tel" inputmode="numeric" placeholder="3xx xxx xxxx" class="in" maxlength="13">
            </label>
          </div>

          <div>
            <label>Departamento
              <select required name="state" class="in">
                <option value="" selected disabled>Selecciona</option>
                <option>Amazonas</option><option>Antioquia</option><option>Arauca</option><option>Atlántico</option>
                <option>Bolívar</option><option>Boyacá</option><option>Caldas</option><option>Caquetá</option><option>Casanare</option><option>Cauca</option><option>Cesar</option>
                <option>Chocó</option><option>Córdoba</option><option>Cundinamarca</option><option>Guainía</option><option>Guaviare</option><option>Huila</option><option>La Guajira</option>
                <option>Magdalena</option><option>Meta</option><option>Nariño</option><option>Norte de Santander</option><option>Putumayo</option><option>Quindío</option><option>Risaralda</option>
                <option>San Andrés y Providencia</option><option>Santander</option><option>Sucre</option><option>Tolima</option><option>Valle del Cauca</option><option>Vaupés</option><option>Vichada</option>
              </select>
            </label>
            <label>Ciudad / Municipio
              <input required name="city" type="text" placeholder="Ej. Bogotá, Medellín" class="in" maxlength="60">
            </label>
          </div>

          <label>Dirección de entrega
            <input required name="address" type="text" placeholder="Calle 00 # 00-00, apto, barrio" class="in" maxlength="120">
          </label>

          <div style="display:none">
            <label>Cantidad
              <select name="qty" class="in">
                <option>1 frasco</option>
                <option>2 frascos</option>
                <option>3 frascos</option>
              </select>
            </label>
          </div>

          <label style="display:flex;gap:10px;align-items:flex-start">
            <input type="checkbox" required name="terms" style="accent-color:var(--red)">
            <span class="muted">Acepto la política de tratamiento de datos y autorizo el contacto para coordinar el envío.</span>
          </label>

          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button type="submit" id="submitBtn" class="btn">
              <span class="btn-text">Confirmar pedido</span>
            </button>
          </div>

          <div id="formMsg" class="muted" role="status" aria-live="polite" style="margin-top:8px"></div>
        </form>

        <div id="formMount"></div>
      </div>

      <div class="footer">
        <small class="muted">Protegemos tus datos. Usamos la información únicamente para gestionar tu pedido.</small>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true">✅ Pedido enviado correctamente</div>

  <!-- JS -->
  <script>
    (function(){
      // URL del webhook (confimado)
      const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby74C6ITsLLaJMw_JciXWFqYNr13EIW6CzDUlEh8xXjbXutwON_1mVg33mO6wH7FSfLWA/exec";

      // Elements
      const modal = document.getElementById('checkoutModal');
      const closeBtn = document.getElementById('closeCheckout');
      const openButtons = Array.from(document.querySelectorAll('a[href="#checkout"], a[href="#oferta"], [data-open-modal]'));
      const offerList = document.getElementById('offerList');
      const offerCards = Array.from(document.querySelectorAll('.offer-card'));
      const totalPrice = document.getElementById('totalPrice');
      const form = document.getElementById('orderForm');
      const formMsg = document.getElementById('formMsg');
      const submitBtn = document.getElementById('submitBtn');
      const toast = document.getElementById('toast');

      let selectedOffer = null;

      // Ensure modal hidden on load
      modal.classList.remove('active');
      document.body.classList.remove('modal-open');

      // Toast helper
      function showToast(text = "✅ Pedido enviado correctamente", type = "success") {
        toast.textContent = text;
        toast.classList.add('show');
        setTimeout(()=> toast.classList.remove('show'), 3000);
      }

      // Open modal
      openButtons.forEach(btn => {
        btn.addEventListener('click', function(e){
          e.preventDefault();
          modal.classList.add('active');
          document.body.classList.add('modal-open');
          modal.setAttribute('aria-hidden','false');
        });
      });

      // Close modal
      closeBtn.addEventListener('click', closeModal);
      function closeModal(){
        modal.classList.remove('active');
        document.body.classList.remove('modal-open');
        modal.setAttribute('aria-hidden','true');
      }
      modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });
      document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeModal(); });

      // Hide qty label (keeps select for backend but not visible)
      const qtySelect = form.querySelector('select[name="qty"]');
      if (qtySelect) {
        const qtyLabel = qtySelect.closest('label');
        if (qtyLabel) qtyLabel.style.display = 'none';
      }

      // Offer selection logic
      function formatCOP(n){
        try { return n.toLocaleString('es-CO',{style:'currency',currency:'COP',maximumFractionDigits:0}); }
        catch(e){ return '$' + n; }
      }

      function selectOffer(card){
        offerCards.forEach(c=>c.classList.remove('active'));
        card.classList.add('active');

        const price = Number(card.dataset.price) || 0;
        totalPrice.textContent = formatCOP(price);

        // Fill hidden inputs (create if missing)
        let offerInput = form.querySelector('input[name="offer"]');
        if (!offerInput) {
          offerInput = document.createElement('input'); offerInput.type='hidden'; offerInput.name='offer';
          form.appendChild(offerInput);
        }
        let priceInput = form.querySelector('input[name="offer_price"]');
        if (!priceInput) {
          priceInput = document.createElement('input'); priceInput.type='hidden'; priceInput.name='offer_price';
          form.appendChild(priceInput);
        }
        offerInput.value = card.dataset.offer;
        priceInput.value = String(price);

        // Autoselect qty (hidden)
        if (qtySelect) {
          const q = parseInt(card.dataset.qty,10) || 1;
          qtySelect.value = q === 1 ? '1 frasco' : `${q} frascos`;
        }

        selectedOffer = { offer: card.dataset.offer, qty: card.dataset.qty, price: price };
      }

      offerCards.forEach(c=>{
        c.addEventListener('click', ()=> selectOffer(c));
        c.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); selectOffer(c); } });
      });

      // Default select (2nd or first)
      selectOffer(offerCards[1] || offerCards[0]);

      // Form submit handler
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        formMsg.textContent = "";
        // anti-spam
        if (form.website && form.website.value !== "") return;

        // Basic validation
        const data = new FormData(form);
        const required = ['name','phone','state','city','address'];
        const invalid = [];
        required.forEach(k=>{
          const el = form.querySelector(`[name="${k}"]`);
          if (!el) return;
          if (!el.value.trim() || !el.checkValidity()) invalid.push(k);
        });
        if (invalid.length) {
          formMsg.textContent = "Por favor completa todos los campos correctamente.";
          showToast("Completa los campos requeridos", "error");
          // highlight fields
          invalid.forEach(k=>{
            const el = form.querySelector(`[name="${k}"]`);
            if (el) el.classList.add('error');
          });
          return;
        }

        // Ensure offer selected
        if (!selectedOffer) {
          formMsg.textContent = "Selecciona una oferta antes de continuar.";
          showToast("Selecciona una oferta", "error");
          return;
        }

        // UX: disable button
        submitBtn.disabled = true;
        const originalBtnText = submitBtn.querySelector('.btn-text')?.textContent || submitBtn.textContent;
        if (submitBtn.querySelector('.btn-text')) submitBtn.querySelector('.btn-text').textContent = "Enviando pedido...";

        // Use FormData to avoid preflight and custom headers (works with GAS webapps)
        try {
          // Append any dynamic offer fields (already added above but ensure)
          if (!form.querySelector('input[name="offer"]')) data.append('offer', selectedOffer.offer || '');
          if (!form.querySelector('input[name="offer_price"]')) data.append('offer_price', selectedOffer.price || '');

          // Send (no custom headers). Use mode:'no-cors' to avoid CORS preflight if your GAS endpoint isn't configured.
          // Warning: with no-cors you won't get useful response details; we optimistically treat as success.
          await fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            body: data
          });

          // success UI (optimistic)
          formMsg.textContent = "✅ Pedido enviado correctamente. Pronto te contactaremos.";
          showToast("✅ Pedido enviado correctamente");
          form.reset();
          // reset totals
          totalPrice.textContent = formatCOP(0);
          // close modal after small delay
          setTimeout(()=> closeModal(), 900);
        } catch(err){
          console.error(err);
          formMsg.textContent = "❌ Hubo un error al enviar. Intenta nuevamente.";
          showToast("❌ Error al enviar el pedido");
        } finally {
          submitBtn.disabled = false;
          if (submitBtn.querySelector('.btn-text')) submitBtn.querySelector('.btn-text').textContent = originalBtnText;
        }
      });

      // Remove error highlight on input
      form.querySelectorAll('.in').forEach(input => input.addEventListener('input', ()=> input.classList.remove('error')));

      // IntersectionObserver to add 'visible' class for lazy images (optional UX)
      if ('IntersectionObserver' in window) {
        const observer = new IntersectionObserver(entries=>{
          entries.forEach(e=>{
            if (e.isIntersecting) e.target.classList.add('visible');
          });
        }, { threshold: 0.2 });
        document.querySelectorAll('img[loading="lazy"]').forEach(img=>observer.observe(img));
      }
    })();
  </script>
</body>
</html>
